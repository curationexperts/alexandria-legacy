#!/usr/bin/env ruby

marc_file = ARGV[0]
bin_path = ARGV[1]

if marc_file.nil?
  $stderr.puts "Usage: #{$PROGRAM_NAME} <marc file> <content directory>"
  $stderr.puts 'Please provide the a file path you want to import.'
  exit(1)
end

if bin_path.nil?
  $stderr.puts 'Binary directory was left blank. No binaries will be ingested'
end

unless File.exist?(marc_file)
  $stderr.puts "File doesn't exist #{marc_file}"
  exit(1)
end

puts 'Loading environment...'
require File.expand_path('../../config/environment', __FILE__)
require 'importer'
puts 'Starting import...'

require 'traject/command_line'
cmdline = Traject::CommandLine.new(['-c', 'lib/traject/audio_config.rb', "#{marc_file}"])
result = cmdline.execute

exit 1 unless result # non-zero exit status on process telling us there's problems.
